@page "/"
@using ScriptContainer
@inject IJSRuntime scriptService

<PageTitle>Index</PageTitle>

<div class="element-container" @ref="ElementA">
  <div class="element" @ref="ElementA">Element A</div>
  <div class="element" @ref="ElementB">Element B</div>
</div>

<h2>Document Bounds</h2>

<ul>
  <li>@DocW</li>
  <li>@DocH</li>
</ul>

<h2>Element Bounds</h2>

<ul>
  <li>@ItemW</li>
  <li>@ItemH</li>
</ul>

@code
{
  public double DocW { get; set; }
  public double DocH { get; set; }
  public double ItemW { get; set; }
  public double ItemH { get; set; }
  public ScriptService ScaleService { get; set; }
  public ElementReference ElementA { get; set; }
  public ElementReference ElementB { get; set; }

  protected override async Task OnAfterRenderAsync(bool setup)
  {
    if (setup)
    {
      ScaleService = new ScriptService(scriptService);

      await ScaleService.CreateModule();
      await GetBounds();

      ScaleService.OnSize = async message => await GetBounds();
    }

    await base.OnAfterRenderAsync(setup);
  }

  protected async Task GetBounds()
  {
    var docBounds = await ScaleService.GetDocBounds();

    DocW = docBounds.Width;
    DocH = docBounds.Height;

    var itemBounds = await ScaleService.GetElementBounds(ElementA);

    ItemW = docBounds.Width;
    ItemH = docBounds.Height;

    await InvokeAsync(StateHasChanged);
  }
}
